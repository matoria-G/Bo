<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><title>XDoclet: Attribute-Oriented Programming - Architecture</title><style type="text/css" media="all">
          @import url("../style/maven-base.css");
          
			    @import url("../style/maven-theme.css");</style><link rel="stylesheet" href="../style/print.css" type="text/css" media="print"></link><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"></meta><meta name="author" content="Aslak Hellesoy"></meta><meta name="email" content="aslak.nospam@users.sf.net"></meta><link rel="shortcut icon" href="../favicon.ico"></link><link rel="icon" href="../favicon.ico"></link></head><body class="composite"><div id="banner"><a href="http://xdoclet.sourceforge.net/" id="organizationLogo"><img alt="XDoclet Team" src="../images/logo.gif"></img></a><a href="http://xdoclet.sourceforge.net/xdoclet/" id="projectLogo"><img alt="XDoclet" src="http://sflogo.sourceforge.net/sflogo.php?group_id=31602&amp;type=5"></img></a><div class="clear"><hr></hr></div></div><div id="breadcrumbs"><div class="xleft">
                	Last published: 16 April 2005
                  | Doc for 1.2.3</div><div class="xright">
        
        <a href="http://xdoclet.sourceforge.net/xdoclet/" class="externalLink" title="External Link">Home</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="http://sourceforge.net/projects/xdoclet/" class="externalLink" title="External Link">SourceForge Project</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="http://xdoclet.sourceforge.net/wiki/" class="externalLink" title="External Link">Wiki</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/xdoclet/" class="externalLink" title="External Link">Browse CVS</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="http://opensource.atlassian.com/projects/xdoclet/secure/CreateIssue!default.jspa" class="externalLink" title="External Link">Create an Issue</a>
      </div><div class="clear"><hr></hr></div></div><div id="leftColumn"><div id="navcolumn"><div id="menuXDoclet"><h5>XDoclet</h5><ul><li class="none"><a href="../index.html">Overview</a></li><li class="none"><a href="../status.html">News and Status</a></li><li class="none"><a href="../install.html">Download/Installation</a></li><li class="none"><a href="../using.html">Using XDoclet</a></li><li class="none"><a href="../bp.html">Best Practices</a></li><li class="none"><a href="../faq.html">FAQ</a></li><li class="none"><a href="../licenses/xdoclet-license.html">License</a></li></ul></div><div id="menuAnt_Task_Reference"><h5>Ant Task Reference</h5><ul><li class="none"><a href="../ant/xdoclet/DocletTask.html">&lt;doclet .. /&gt;</a></li><li class="none"><a href="../ant/xdoclet/modules/ejb/EjbDocletTask.html">&lt;ejbdoclet .. /&gt;</a></li><li class="none"><a href="../ant/xdoclet/modules/hibernate/HibernateDocletTask.html">&lt;hibernatedoclet .. /&gt;</a></li><li class="none"><a href="../ant/xdoclet/modules/jdo/JdoDocletTask.html">&lt;jdodoclet .. /&gt;</a></li><li class="none"><a href="../ant/xdoclet/modules/jmx/JMXDocletTask.html">&lt;jmxdoclet .. /&gt;</a></li><li class="none"><a href="../ant/xdoclet/modules/mockobjects/MockObjectDocletTask.html">&lt;mockdoclet .. /&gt;</a></li><li class="none"><a href="../ant/xdoclet/modules/portlet/PortletDocletTask.html">&lt;portletdoclet .. /&gt;</a></li><li class="none"><a href="../ant/xdoclet/modules/spring/SpringDocletTask.html">&lt;springdoclet .. /&gt;</a></li><li class="none"><a href="../ant/xdoclet/modules/apache/tapestry/TapestryDocletTask.html">&lt;tapestrydoclet .. /&gt;</a></li><li class="none"><a href="../ant/xdoclet/modules/web/WebDocletTask.html">&lt;webdoclet .. /&gt;</a></li><li class="none"><a href="../ant/xdoclet/modules/wsee/WseeDocletTask.html">&lt;wseedoclet .. /&gt;</a></li></ul></div><div id="menuTag_Reference"><h5>Tag Reference</h5><ul><li class="none"><a href="../tags/apache-tags.html">apache (@soap @struts @axis @tapestry)</a></li><li class="none"><a href="../tags/bea-tags.html">bea (@weblogic)</a></li><li class="none"><a href="../tags/borland-tags.html">borland (@bes)</a></li><li class="none"><a href="../tags/caucho-tags.html">caucho (@resin)</a></li><li class="none"><a href="../tags/ejb-tags.html">ejb (@ejb @dao)</a></li><li class="none"><a href="../tags/exolab-tags.html">exolab (@castor)</a></li><li class="none"><a href="../tags/hp-tags.html">hp (@hpas)</a></li><li class="none"><a href="../tags/hibernate-tags.html">hibernate (@hibernate)</a></li><li class="none"><a href="../tags/ibm-tags.html">ibm (@websphere)</a></li><li class="none"><a href="../tags/java-tags.html">java (@javabean)</a></li><li class="none"><a href="../tags/jboss-tags.html">jboss (@jboss)</a></li><li class="none"><a href="../tags/jdo-tags.html">jdo (@jdo)</a></li><li class="none"><a href="../tags/jmx-tags.html">jmx (@jmx)</a></li><li class="none"><a href="../tags/jsf-tags.html">jsf (@jsf)</a></li><li class="none"><a href="../tags/macromedia-tags.html">macromedia (@jrun)</a></li><li class="none"><a href="../tags/mockobjects-tags.html">mockobjects (@mock)</a></li><li class="none"><a href="../tags/mvcsoft-tags.html">mvcsoft (@mvcsoft)</a></li><li class="none"><a href="../tags/mx4j-tags.html">mx4j (@mx4j)</a></li><li class="none"><a href="../tags/objectweb-tags.html">objectweb (@jonas)</a></li><li class="none"><a href="../tags/oracle-tags.html">oracle (@oc4j)</a></li><li class="none"><a href="../tags/orion-tags.html">orion (@orion)</a></li><li class="none"><a href="../tags/portlet-tags.html">portlet (@portlet)</a></li><li class="none"><a href="../tags/pramati-tags.html">pramati (@pramati)</a></li><li class="none"><a href="../tags/spring-tags.html">spring (@spring)</a></li><li class="none"><a href="../tags/sun-tags.html">sun (@sunone)</a></li><li class="none"><a href="../tags/sybase-tags.html">sybase (@easerver)</a></li><li class="none"><a href="../tags/tjdo-tags.html">tjdo (@tjdo)</a></li><li class="none"><a href="../tags/web-tags.html">web (@web @jsp)</a></li><li class="none"><a href="../tags/webwork-tags.html">webwork (@webwork)</a></li><li class="none"><a href="../tags/wsee-tags.html">wsee (@wsee)</a></li><li class="none"><a href="../tags/xdoclet-tags.html">xdoclet (@xdoclet @doc @msg)</a></li></ul></div><div id="menuFeature_Documentation"><h5>Feature Documentation</h5><ul><li class="none"><a href="../valueobjects.html">Using Value Objects</a></li><li class="none"><a href="../envhandling.html">EJB Environment Handling</a></li></ul></div><div id="menuAdvanced"><h5>Advanced</h5><ul><li class="none"><a href="../maven-plugin.html">Maven Plug-in</a></li><li class="none"><a href="../merge.html">Merge Points</a></li><li class="none"><a href="../ide/index.html">IDE Integration</a></li><li class="none"><a href="../migration.html">Migration from EJBDoclet</a></li><li class="none"><a href="../ant15.html">Ant 1.5 Troubleshooting</a></li></ul></div><div id="menuCommunity"><h5>Community</h5><ul><li class="none"><a href="../feedback.html">Feedback</a></li><li class="none"><a href="../resources.html">Resources</a></li><li class="none"><a href="../tools.html">Tools</a></li></ul></div><div id="menuDevelopment"><h5>Development</h5><ul><li class="none"><a href="../development/index.html">Developer Guide</a></li><li class="none"><a href="../api/index.html">Javadoc (API)</a></li><li class="none"><a href="../templates/index.html">Template Language (*.xdt)</a></li><li class="none"><a href="http://xdoclet.sourceforge.net/xjavadoc/" class="externalLink" title="External Link">XJavaDoc Site</a></li></ul></div><div id="search"><h5>Search XDoclet</h5><form action="http://www.google.com/search" method="get"><a href="http://www.google.com" class="navlink"><img height="32" width="75" alt="Google" src="http://www.google.com/logos/Logo_25wht.gif"></img></a><input name="q" maxlength="255" size="15" type="text" value="" id="q"></input><input name="btnG" type="submit" value="Go" id="btnG"></input><input name="domains" type="hidden" value="http://xdoclet.sourceforge.net/xdoclet"></input><input name="sitesearch" type="hidden" value="http://xdoclet.sourceforge.net/xdoclet" id="search"></input></form></div><div id="menuProject_Documentation"><h5>Project Documentation</h5><ul><li class="none"><a href="../index.html">About XDoclet</a></li><li class="collapsed"><a href="../project-info.html">Project Info</a></li><li class="collapsed"><a href="../maven-reports.html">Project Reports</a></li><li class="none"><a href="http://maven.apache.org/development-process.html" class="externalLink" title="External Link">Development Process</a></li></ul></div><a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy"><img alt="Built by Maven" src="../images/logos/maven-button-1.png"></img></a></div></div><div id="bodyColumn"><div class="contentBox"><div class="section"><a name="Architecture"></a><h2>Architecture</h2><p>
                This section is for those who want to develop new modules for XDoclet. End users
                who just use the tool do not need to read this section, but it's an essential read for
                those who want to write custom modules or want to contribute.
            </p><p>
                XDoclet mainly consists out of five components:
                <ul>
                    <li>XDoclet Engine</li>
                    <li>XJavaDoc Engine</li>
                    <li>Subtasks (contained in modules)</li>
                    <li>Templates (contained in modules)</li>
                    <li>Tag Handlers (contained in modules)</li>
                </ul>

                Although there are several modules (and therefore several subtasks and tag handlers), all sub tasks
                are built for the same framework: the framework provided by the XDoclet and the XJavaDoc engines.
            </p><div class="subsection"><a name="XDoclet_Engine"></a><h3>XDoclet Engine</h3><p>
                    The XDoclet engine provides the template engine that
                    transforms a template to a file. A template consists of static content and dynamic
                    content, very much in the same way as a JSP page or a Velocity template.
                </p><p>
                    Further, XDoclet contains a <a href="http://ant.apache.org/" class="externalLink" title="External Link">Jakarta Ant</a> task
                    that will invoke the templates (via subtasks). Part of XDoclet is also a loader that
                    will dynamically discover and plug in XDoclet modules (via <code>xdoclet.xml</code> file
                    contained in the module's jar file).
                </p><p>
                    The XDoclet engine also contains general-purpose tag handlers that act as a bridge between
                    templates and XJavaDoc. This makes it possible for the templates to access the information in the
                    XJavaDoc beans.
                </p></div><div class="subsection"><a name="XJavaDoc_Engine"></a><h3>XJavaDoc Engine</h3><p>
                    The XJavaDoc engine is a complete rewrite of Sun's JavaDoc engine that is faster
                    and more suited for XDoclet (although it is completely stand alone). It scans java source code
                    and makes information about a class available via special java beans that are part of the
                    XJavaDoc core. These beans provide the same information about a class as Sun's JavaDoc API,
                    and some nice extra features.
                </p><p>
                    The extra features of XJavaDoc is the possibility to programmatically modify the javadoc
                    tags and save the source code, as well as an extra API for extracting information from @tags
                    that are using an XML-like attribute scheme.
                </p><p>
                    XJavaDoc was written because Sun's classic JavaDoc engine was too slow, printed
                    too many warnings to standard output and wasn't well suited for XDoclet's purposes
                    (nobody knew by the time of JavaDoc's writing that a tool like XDoclet would show up).
                    XJavaDoc is approximately <b>5 times faster</b> than JavaDoc and is based on
                    <a href="https://javacc.dev.java.net/">JavaCC</a>.
                </p><p>
                    Further, XJavaDoc has its own Jakarta Ant task (which XDoclet's Ant task inherits from) that
                    makes it easier to deal with than the Ant javadoc task.
                </p></div><div class="subsection"><a name="Subtasks"></a><h3>Subtasks</h3><p>
                    A subtask is a class that tells the XDoclet engine what templates to invoke and how to invoke them.
                    Each subtask specifies a name and a parent task. Subtasks are invoked by nesting an element under
                    an XDoclet ant task invocation:
                </p>
    <div class="source"><pre>&lt;ejbdoclet ...&gt;
    &lt;remoteinterface/&gt;
&lt;/ejbdoclet&gt;</pre></div>
  <p>
                    Subtasks have logical names and belong under certain tasks. This information is included
                    in special tags in the header of the subtask. Let's take a look at the RemoteInterfaceSubTask
                    that is located in the ejb module:
                </p>
    <div class="source"><pre>
/**
 * @ant.element
 *    display-name="Remote Interface"
 *    name="remoteinterface"
 *    parent="xdoclet.modules.ejb.EjbDocletTask"
 */
public class RemoteInterfaceSubTask extends AbstractEjbCodeGeneratorSubTask
{
...</pre></div>
  <p>
                    The information in the <code>@ant.element</code> is used during build of the module to generate a special
                    deployment descriptor for the module. Take a look at the <code>xdoclet.xml</code> file inside the
                    <code>xdoclet-ejb-module.jar</code>, and you'll see the following entry:
                </p>
    <div class="source"><pre>
&lt;subtask
   name="remoteinterface"
   implementation-class="xdoclet.modules.ejb.intf.RemoteInterfaceSubTask"
   parent-task-class="xdoclet.modules.ejb.EjbDocletTask"
/&gt;</pre></div>
  <p>
                    The XDoclet core reads this deployment descriptor at start-up and uses the information
                    to map a logical name to a class name. It instantiates the corresponding class and invokes
                    the <code>execute()</code> method to start the subtask.
                </p><p>
                    As you see, XDoclet itself is used during the build of the modules, and all this functionality is
                    in the XDoclet core. This makes it easy to write new sub tasks. Just extend <code>xdoclet.SubTask</code>
                    and put the <code>@ant.element</code> tag in the class header. Looking at other subtasks and the javadocs should give
                    you a good starting point.
                </p><p>
                    Last, but not least, the information in the same tag is used when generating the documentation.
                </p></div><div class="subsection"><a name="Templates"></a><h3>Templates</h3><p>
                    At the core of XDoclet's extensibility are the template files. An XDoclet template is a file that contains
                    static parts and dynamic parts. The static parts will be rendered "as is", and the dynamic parts will be substituted
                    by content provided by a tag handler.
                </p><p>
                    The XDoclet templates are not XML files, but they're using an XML-like syntax to add logic and content
                    to the templates. Here is a part of a template that generates a method in a Java source file (slightly reformatted
                    for the sake of readability):
                </p>
    <div class="source"><pre>
/**
 * &lt;XDtI18n:getString bundle="xdoclet.modules.ejb" resource="util_obtain_localhome_def_ic"/&gt;
 * @return &lt;XDtI18n:getString
    bundle="xdoclet.modules.ejb"
    resource="local_home_interface_for"
    arguments="&lt;XDtEjb:ejbName/&gt;"/&gt;
    &lt;XDtI18n:getString
    bundle="xdoclet.modules.ejb"
    resource="util_lookup_using"
    arguments="&lt;XDtEjbUtilObj:lookupKind/&gt;"/&gt;
 */
public static &lt;XDtEjbHome:homeInterface type="local"/&gt; getLocalHome() throws NamingException
{
   // &lt;XDtI18n:getString bundle="xdoclet.modules.ejb" resource="util_localhome_not_narrowed"/&gt;
   &lt;XDtConfig:ifConfigParamEquals paramName="cacheHomes" value="true"&gt;
   if (cachedLocalHome == null) {
      // &lt;XDtI18n:getString bundle="xdoclet.modules.ejb" resource="util_obtain_ic"/&gt;
      InitialContext initialContext = new InitialContext();
      try {
         cachedLocalHome = (&lt;XDtEjbHome:homeInterface type="local"/&gt;)
            initialContext.lookup(&lt;XDtEjbHome:homeInterface type="local"/&gt;.&lt;XDtEjbUtilObj:lookupKind/&gt;);
      } finally {
         initialContext.close();
      }
   }
   return cachedLocalHome;
   &lt;/XDtConfig:ifConfigParamEquals&gt;
   &lt;XDtConfig:ifConfigParamNotEquals paramName="cacheHomes" value="true"&gt;
   // &lt;XDtI18n:getString bundle="xdoclet.modules.ejb" resource="util_obtain_ic"/&gt;
   InitialContext initialContext = new InitialContext();
   try {
      return (&lt;XDtEjbHome:homeInterface type="local"/&gt;)
         initialContext.lookup(&lt;XDtEjbHome:homeInterface type="local"/&gt;.&lt;XDtEjbUtilObj:lookupKind/&gt;);
   } finally {
      initialContext.close();
   }
   &lt;/XDtConfig:ifConfigParamNotEquals&gt;
}</pre></div>
  <p>
                    And this one shows a template file that generates parts of an XML file:
                </p>
    <div class="source"><pre>
&lt;!-- Entity Beans --&gt;
&lt;XDtClass:forAllClasses type="javax.ejb.EntityBean"&gt;
 &lt;XDtEjb:ifIsAConcreteEJBean&gt;
  &lt;XDtEjbCmp:ifEntityIsCmp&gt;
   &lt;entity &lt;XDtId:prefixedId prefix="ContainerManagedEntity"/&gt;&gt;
  &lt;/XDtEjbCmp:ifEntityIsCmp&gt;
  &lt;XDtEjbBmp:ifEntityIsBmp&gt;
   &lt;entity &lt;XDtId:prefixedId prefix="BeanManagedEntity"/&gt;&gt;
  &lt;/XDtEjbBmp:ifEntityIsBmp&gt;
     &lt;XDtMerge:merge file="xdoclet/modules/ejb/dd/resources/ejb-body.xdt"&gt;
     &lt;/XDtMerge:merge&gt;
   &lt;/entity&gt;
 &lt;/XDtEjb:ifIsAConcreteEJBean&gt;
&lt;/XDtClass:forAllClasses&gt;</pre></div>
  <p>
                    The XDoclet template engine can generate any kind of file. It isn't limited to Java or XML.
                    A perfect example of this is XDoclet's ability to generate a todo list from @todo tags in your
                    code. But let's get back to the first template.
                </p><p>
                    When the first template has been rendered, you'll end up with a Java source file that
                    contains this fragment:
                </p>
    <div class="source"><pre>
/**
 * Obtain local home interface from default initial context
 * @return Local home interface for Person. Lookup using JNDI_NAME
 */
public static airline.ejb.interfaces.PersonLocalHome getLocalHome() throws NamingException
{
   // Local homes shouldn't be narrowed, as there is no RMI involved.
   // Obtain initial context
   InitialContext initialContext = new InitialContext();
   try {
      return (airline.ejb.interfaces.PersonLocalHome)
            initialContext.lookup(airline.ejb.interfaces.PersonLocalHome.JNDI_NAME);
   } finally {
      initialContext.close();
   }
}</pre></div>
  <p>
                    Here you see several tags. A tag is an XML-like element that consists of a namespace (followed by a . (dot))
                    and then by a tag name. Further, each tag can have an arbitrary number of attributes (also referred to as parameters).
                    Don't get confused, these tags have nothing to do with javadoc @tags.
                </p></div><div class="subsection"><a name="Tag_Handlers"></a><h3>Tag Handlers</h3><p>
                    When XDoclet's template engine encounters a tag, it will use the namespace to obtain a reference to an object whose
                    class is a subclass of <code>xdoclet.TagHandler</code>. Then it will use reflection to invoke a method on that
                    tag handler that corresponds to the name of the tag (the part following the :).
                </p><p>
                    So how does the template engine know what tag handler java object to use? This is done by looking at a map that
                    maps the namespace to a class. This information is also included in the <code>xdoclet.xml</code> file of a module:
                </p>
    <div class="source"><pre>
&lt;taghandler
   namespace="EjbUtilObj"
   class="xdoclet.modules.ejb.lookup.LookupUtilTagsHandler"
/&gt;</pre></div>
  <p>
                    So when the template engine encounters <code>&lt;XDtEjbUtilObj:lookupKind/&gt;</code> it will invoke the
                    lookupKind on an instance of <code>xdoclet.modules.ejb.lookup.LookupUtilTagsHandler</code>. (The XDt part is stripped away
                    before looking in the namespace-&gt;taghandler object map).
                </p><p>
                    If you look closely at this template fragment, you'll see that there are two kinds of tags: Tags that have
                    a body, and tags that don't. These are respectively known as block tags and content tags. Block tags "do"
                    something, and content tags "return" something.
                </p><p>
                    A block tag can evaluate its body or it cannot. It can do this as many times as it wants. Block tags
                    are used to loop or to have conditional evaluation of the tag's body. The methods that implement block
                    tags are <code>void</code> methods.
                </p><p>
                    A content tag is a tag that returns a value, and every occurrence of a content tag will be substituted by
                    a String value.
                </p><p>
                    Tag handler classes are documented with special javadoc tags too. This is in order to generate the taghandler
                    elements in the <code>xdoclet.xml</code> deployment descriptor. The <code>xdoclet.modules.ejb.lookup.LookupUtilTagsHandler</code>
                    class has the following header:
                </p>
    <div class="source"><pre>
/**
 * @xdoclet.taghandler namespace="EjbUtilObj"
 */
public class LookupUtilTagsHandler extends EjbTagsHandler
{
   ...</pre></div>
  </div></div></div></div><div class="clear"><hr></hr></div><div id="footer"><div class="xright">© 2000-2005, XDoclet Team</div><div class="clear"><hr></hr></div></div></body></html>